![react-native-audiosprites_poster](react-native-audiosprites_poster.jpg)

# react-native-audiosprites

A universal player for audio sprites generated by the 'audiosprite' tool.
Supports playing multiple sounds at same time!

## Installation

```sh
npm install react-native-audiosprites
```

```sh
yarn add react-native-audiosprites
```

## Usage

First, you need to generate an audio sprite and a JSON manifest file using the `audiosprite` tool.

Assuming you have [`audiosprite`](https://www.npmjs.com/package/audiosprite) installed globally:

```sh
audiosprite --output audiosprite --format howler --path ./src/__tests__/ Sound_1.m4a Sound_2.m4a Sound_3.m4a Sound_4.m4a
```

This command will generate `audiosprite.json`, `audiosprite.mp3`, `audiosprite.ogg`, `audiosprite.m4a`, and `audiosprite.ac3` in the `src/__tests__/` directory. The `--path` argument is important as it tells the player where to find the audio files relative to the JSON manifest.

Then, you can use the `AudioSpritePlayer` to play the sounds from the sprite.

### Browser Environment

```typescript
import { AudioSpritePlayer } from 'react-native-audiosprites';

const player = new AudioSpritePlayer({
  platform: 'web',
});

async function playSound(soundName: string) {
  try {
    // Load the audio sprite manifest and audio files
    // Adjust the path to your audiosprite.json file
    await player.load('./src/__tests__/audiosprite.json');
    console.log('Audio sprite loaded successfully.');

    // Play a sound from the spritemap
    player.play(soundName);
    console.log(`Playing sound: ${soundName}`);
  } catch (error) {
    console.error('Error playing sound:', error);
  }
}

// Example usage:
playSound('Sound_1');
// playSound('Sound_2');
```

### React Native Environment

For React Native, you'll need `react-native-audio-api` and `expo-asset` to handle audio playback and asset loading.

First, install the dependencies:

```sh
npm install react-native-audio-api expo-asset expo-file-system
# or
yarn add react-native-audio-api expo-asset expo-file-system
```

Change `metro.config.js` as per `react-native-audio-api` documentation: https://docs.swmansion.com/react-native-audio-api/docs/fundamentals/getting-started

```js
module.exports = wrapWithAudioAPIMetroConfig(config);
```

Then, you can use it in your component:

```typescript
import { StyleSheet, View, Text, Button, Platform } from 'react-native';
import { AudioSpritePlayer } from 'react-native-audiosprites';
import { AudioManager, AudioContext } from 'react-native-audio-api';
import { useEffect, useState, useRef } from 'react';
import { Asset } from 'expo-asset';
import { fetch } from 'expo/fetch';
import manifest from '../assets/audiosprite.json';

// Import the audio asset
const audioAsset = require('../assets/audiosprite.mp3');

export default function App() {
  const [isLoaded, setIsLoaded] = useState(false);
  const playerRef = useRef<AudioSpritePlayer | null>(null);

  useEffect(() => {
    const loadPlayer = async () => {
      const asset = Asset.fromModule(audioAsset);
      await asset.downloadAsync();
      const audioUri = asset.localUri || asset.uri;

      if (!audioUri) {
        console.error('Failed to get audio URI.');
        return;
      }

      if (Platform.OS === 'ios') {
        try {
          await AudioManager.setAudioSessionOptions({
            iosCategory: 'playback',
            iosOptions: ['mixWithOthers'],
          });
          await AudioManager.setAudioSessionActivity(true);
        } catch (e) {
          console.error('Failed to configure AudioSession options:', e);
        }
      }

      const audioContext = new AudioContext();
      const audioPlayer = new AudioSpritePlayer({
        audioContext,
        fetch: fetch.bind(globalThis),
        platform: Platform.OS,
      });

      try {
        await audioPlayer.load(manifest, audioUri);
        playerRef.current = audioPlayer;
        setIsLoaded(true);
        console.log('Audio sprite loaded successfully.');
      } catch (error) {
        console.error('Failed to load audio sprite:', error);
      }
    };

    loadPlayer();
  }, []);

  const playSound = (soundName: string) => {
    const player = playerRef.current;
    if (player && isLoaded) {
      player.play(soundName);
      console.log(`Playing sound: ${soundName}`);
    } else {
      console.warn('Player not loaded yet.');
    }
  };

  return (
    <View style={styles.container}>
      <Text>AudioSprite Player Example</Text>
      <Button
        title="Play Sound 1"
        onPress={() => playSound('Sound_1')}
        disabled={!isLoaded}
      />
      <Button
        title="Play Sound 2"
        onPress={() => playSound('Sound_2')}
        disabled={!isLoaded}
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
  },
});
```

## Contributing

- [Development workflow](CONTRIBUTING.md#development-workflow)
- [Sending a pull request](CONTRIBUTING.md#sending-a-pull-request)
- [Code of conduct](CODE_OF_CONDUCT.md)

## License

MIT

---

Made with [create-react-native-library](https://github.com/callstack/react-native-builder-bob)
